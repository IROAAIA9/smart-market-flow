<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Market OneApp â€” Interactive Flow Diagram</title>
    <style>
        :root {
            --raiffeisen-yellow: #FFDD00;
            --raiffeisen-dark: #1A1A2E;
            --raiffeisen-blue: #16213E;
            --raiffeisen-accent: #0F3460;
            --success-green: #00C853;
            --error-red: #FF5252;
            --cashback-purple: #7C4DFF;
            --points-orange: #FF9800;
            --trees-green: #4CAF50;
            --voucher-pink: #E91E63;
            --card-bg: #ffffff;
            --border-light: #e0e0e0;
            --text-primary: #212121;
            --text-secondary: #757575;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(135deg, var(--raiffeisen-dark) 0%, var(--raiffeisen-blue) 50%, var(--raiffeisen-accent) 100%); color: white; padding: 30px 40px; text-align: center; position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: -50%; left: -10%; width: 120%; height: 200%; background: radial-gradient(ellipse, rgba(255,221,0,0.08) 0%, transparent 70%); }
        .header h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 8px; position: relative; }
        .header h1 span { color: var(--raiffeisen-yellow); }
        .header p { font-size: 1rem; opacity: 0.8; position: relative; }
        .badge-row { display: flex; justify-content: center; gap: 12px; margin-top: 16px; flex-wrap: wrap; position: relative; }
        .badge { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 5px 14px; font-size: 0.78rem; backdrop-filter: blur(4px); }
        .nav-tabs { display: flex; justify-content: center; gap: 6px; padding: 16px 20px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: sticky; top: 0; z-index: 100; flex-wrap: wrap; }
        .nav-tab { padding: 8px 18px; border-radius: 20px; border: 1.5px solid var(--border-light); background: white; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.25s; color: var(--text-secondary); }
        .nav-tab:hover { border-color: var(--raiffeisen-accent); color: var(--raiffeisen-accent); }
        .nav-tab.active { background: var(--raiffeisen-dark); color: white; border-color: var(--raiffeisen-dark); }
        .section { max-width: 1200px; margin: 0 auto; padding: 30px 20px; display: none; }
        .section.active { display: block; }
        .section-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; gap: 10px; }
        .section-subtitle { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 24px; }
        .flow-container { display: flex; flex-direction: column; gap: 0; align-items: center; }
        .flow-step { background: var(--card-bg); border-radius: 16px; padding: 24px 28px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); width: 100%; max-width: 700px; position: relative; border-left: 4px solid var(--raiffeisen-accent); transition: transform 0.2s, box-shadow 0.2s; }
        .flow-step:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
        .flow-step.highlight-yellow { border-left-color: var(--raiffeisen-yellow); }
        .flow-step.highlight-green { border-left-color: var(--success-green); }
        .flow-step.highlight-red { border-left-color: var(--error-red); }
        .flow-step.highlight-purple { border-left-color: var(--cashback-purple); }
        .flow-step.highlight-orange { border-left-color: var(--points-orange); }
        .flow-step.highlight-pink { border-left-color: var(--voucher-pink); }
        .step-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .step-number { background: var(--raiffeisen-dark); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
        .step-number.yellow { background: var(--raiffeisen-yellow); color: var(--raiffeisen-dark); }
        .step-number.green { background: var(--success-green); }
        .step-number.red { background: var(--error-red); }
        .step-number.purple { background: var(--cashback-purple); }
        .step-number.orange { background: var(--points-orange); }
        .step-number.pink { background: var(--voucher-pink); }
        .step-title { font-weight: 700; font-size: 1.05rem; }
        .step-body { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }
        .step-body code { background: #f0f4f8; padding: 2px 8px; border-radius: 4px; font-size: 0.82rem; color: var(--raiffeisen-accent); font-weight: 600; }
        .arrow-connector { display: flex; flex-direction: column; align-items: center; padding: 4px 0; }
        .arrow-line { width: 2px; height: 24px; background: var(--raiffeisen-accent); }
        .arrow-head { width: 0; height: 0; border-left: 7px solid transparent; border-right: 7px solid transparent; border-top: 8px solid var(--raiffeisen-accent); }
        .arrow-label { font-size: 0.72rem; color: var(--text-secondary); background: #f0f4f8; padding: 2px 10px; border-radius: 10px; margin: 4px 0; font-weight: 500; }
        .decision-box { background: linear-gradient(135deg, #fff8e1, #fff3c4); border: 2px solid var(--raiffeisen-yellow); border-radius: 12px; padding: 18px 24px; text-align: center; max-width: 500px; width: 100%; font-weight: 600; font-size: 0.95rem; position: relative; }
        .decision-box::before { content: 'â—†'; position: absolute; top: -14px; left: 50%; transform: translateX(-50%); background: var(--raiffeisen-yellow); color: var(--raiffeisen-dark); width: 26px; height: 26px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 0.7rem; }
        .branch-container { display: flex; gap: 24px; width: 100%; max-width: 700px; justify-content: center; }
        .branch { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0; }
        .branch-label { font-size: 0.8rem; font-weight: 700; padding: 4px 14px; border-radius: 12px; margin-bottom: 8px; }
        .branch-label.yes { background: #e8f5e9; color: #2e7d32; }
        .branch-label.no { background: #ffebee; color: #c62828; }
        .branch .flow-step { max-width: 100%; }
        .phone-mockup { background: var(--raiffeisen-dark); border-radius: 32px; padding: 12px; max-width: 320px; margin: 0 auto; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .phone-screen { background: white; border-radius: 22px; overflow: hidden; min-height: 520px; }
        .phone-statusbar { background: var(--raiffeisen-dark); color: white; padding: 8px 16px; font-size: 0.7rem; display: flex; justify-content: space-between; }
        .phone-header { background: var(--raiffeisen-dark); color: white; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; }
        .phone-header h3 { font-size: 1rem; }
        .phone-content { padding: 16px; }
        .screen-state-tabs { display: flex; border-bottom: 1px solid #eee; background: #fafafa; }
        .screen-state-tab { flex: 1; padding: 6px 4px; font-size: 0.6rem; font-weight: 600; text-align: center; cursor: pointer; border-bottom: 2px solid transparent; color: #999; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.3px; }
        .screen-state-tab:hover { color: #333; }
        .screen-state-tab.active { color: var(--raiffeisen-dark); border-bottom-color: var(--raiffeisen-yellow); }
        .screen-state-content { display: none; }
        .screen-state-content.active { display: block; }
        .figma-source { display: flex; align-items: center; justify-content: center; gap: 4px; padding: 4px 0; font-size: 0.6rem; color: #aaa; background: #f9f9f9; border-top: 1px solid #eee; }
        .figma-source svg { width: 10px; height: 10px; }
        .hub-reward-row { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.15s; }
        .hub-reward-row:hover { background: #fafafa; }
        .hub-reward-row:last-child { border-bottom: none; }
        .hub-reward-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; flex-shrink: 0; }
        .hub-reward-info { flex: 1; }
        .hub-reward-info .rw-label { font-size: 0.82rem; font-weight: 600; color: #1a1a1a; }
        .hub-reward-info .rw-value { font-size: 0.72rem; color: #666; margin-top: 2px; }
        .hub-reward-chevron { color: #ccc; font-size: 0.9rem; }
        .balance-hero { text-align: center; padding: 24px 16px 16px; background: linear-gradient(180deg, #fff 0%, #fafafa 100%); }
        .balance-hero .hero-icon { font-size: 2.2rem; margin-bottom: 4px; }
        .balance-hero .hero-value { font-size: 2.4rem; font-weight: 800; line-height: 1.1; }
        .balance-hero .hero-unit { font-size: 0.85rem; color: #888; margin-top: 2px; }
        .action-chips { display: flex; gap: 8px; padding: 0 16px 12px; justify-content: center; }
        .action-chip { padding: 7px 14px; border-radius: 20px; font-size: 0.72rem; font-weight: 600; cursor: pointer; transition: transform 0.15s; text-align: center; }
        .action-chip:hover { transform: scale(1.04); }
        .expiring-banner { margin: 0 16px 12px; padding: 10px 12px; border-radius: 12px; display: flex; align-items: center; gap: 10px; font-size: 0.78rem; }
        .expiring-banner .exp-icon { font-size: 1.1rem; flex-shrink: 0; }
        .expiring-banner .exp-text { flex: 1; }
        .expiring-banner .exp-text strong { display: block; }
        .expiring-banner .exp-text span { font-size: 0.7rem; color: #888; }
        .expiring-banner .exp-arrow { color: #bbb; }
        .info-banner { margin: 0 16px 12px; padding: 10px 12px; border-radius: 12px; display: flex; align-items: center; gap: 8px; font-size: 0.75rem; line-height: 1.35; }
        .ptx-header { display: flex; justify-content: space-between; align-items: center; padding: 0 16px 6px; font-size: 0.82rem; font-weight: 700; }
        .ptx-header .view-all { font-size: 0.72rem; font-weight: 600; cursor: pointer; }
        .ptx-item { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-bottom: 1px solid #f5f5f5; }
        .ptx-item:last-child { border-bottom: none; }
        .ptx-dot { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; flex-shrink: 0; }
        .ptx-detail { flex: 1; }
        .ptx-detail .ptx-name { font-size: 0.78rem; font-weight: 600; color: #1a1a1a; }
        .ptx-detail .ptx-date { font-size: 0.68rem; color: #999; margin-top: 1px; }
        .ptx-amt { font-size: 0.82rem; font-weight: 700; text-align: right; }
        .ptx-amt.credit { color: #2e7d32; }
        .ptx-amt.debit { color: #c62828; }
        .co2-banner { margin: 0 16px 12px; padding: 12px; border-radius: 12px; text-align: center; }
        .co2-banner .co2-value { font-size: 1.3rem; font-weight: 800; }
        .co2-banner .co2-label { font-size: 0.7rem; color: #666; margin-top: 2px; }
        .api-table { width: 100%; border-collapse: separate; border-spacing: 0; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); margin: 16px 0; }
        .api-table th { background: var(--raiffeisen-dark); color: white; padding: 12px 16px; text-align: left; font-size: 0.82rem; font-weight: 600; }
        .api-table td { padding: 10px 16px; border-bottom: 1px solid #f0f0f0; font-size: 0.85rem; }
        .api-table tr:nth-child(even) { background: #fafafa; }
        .api-table tr:hover { background: #f5f5f5; }
        .method-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.72rem; font-weight: 700; color: white; }
        .method-badge.get { background: #4CAF50; }
        .method-badge.post { background: #FF9800; }
        .method-badge.delete { background: #F44336; }
        .arch-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .arch-card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border-top: 4px solid var(--raiffeisen-accent); transition: transform 0.2s; }
        .arch-card:hover { transform: translateY(-3px); }
        .arch-card h4 { font-size: 1rem; margin-bottom: 4px; }
        .arch-card .phase-label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .arch-card.current { border-top-color: var(--error-red); }
        .arch-card.current .phase-label { color: var(--error-red); }
        .arch-card.transition { border-top-color: var(--points-orange); }
        .arch-card.transition .phase-label { color: var(--points-orange); }
        .arch-card.target { border-top-color: var(--success-green); }
        .arch-card.target .phase-label { color: var(--success-green); }
        .arch-flow { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
        .arch-node { background: #f0f4f8; padding: 6px 12px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; }
        .arch-arrow { color: var(--text-secondary); font-size: 1.1rem; }
        .pool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin: 20px 0; }
        .pool-card { background: white; border-radius: 14px; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.06); transition: transform 0.2s; }
        .pool-card:hover { transform: translateY(-3px); }
        .pool-card .pool-id { font-size: 2rem; font-weight: 800; margin-bottom: 4px; }
        .pool-card.p2 { border-bottom: 4px solid var(--cashback-purple); }
        .pool-card.p2 .pool-id { color: var(--cashback-purple); }
        .pool-card.p3 { border-bottom: 4px solid var(--points-orange); }
        .pool-card.p3 .pool-id { color: var(--points-orange); }
        .pool-card.p4 { border-bottom: 4px solid var(--trees-green); }
        .pool-card.p4 .pool-id { color: var(--trees-green); }
        .pool-card.pv { border-bottom: 4px solid var(--voucher-pink); }
        .pool-card.pv .pool-id { color: var(--voucher-pink); }
        .jira-badge { display: inline-flex; align-items: center; gap: 4px; background: #e3f2fd; color: #1565c0; padding: 3px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; margin: 2px; text-decoration: none; }
        .jira-badge:hover { background: #bbdefb; }
        .legend { display: flex; gap: 16px; flex-wrap: wrap; margin: 16px 0; padding: 14px 20px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.8rem; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        @media (max-width: 768px) { .header h1 { font-size: 1.5rem; } .branch-container { flex-direction: column; } .section { padding: 20px 14px; } .nav-tabs { gap: 4px; padding: 10px; } .nav-tab { padding: 6px 12px; font-size: 0.78rem; } .arch-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸª <span>Smart Market</span> OneApp Flow</h1>
    <p>Complete end-to-end integration flow â€” Raiffeisen Bank Romania</p>
    <div class="badge-row">
        <span class="badge">ğŸ“± OneApp (Athena PI)</span>
        <span class="badge">â˜• Java 21 BFF</span>
        <span class="badge">ğŸ”— XLS / Collinson</span>
        <span class="badge">ğŸ” ISAM â†’ Cloud SSO</span>
        <span class="badge">ğŸ“… Jan 2026</span>
    </div>
</div>
<div class="nav-tabs" id="navTabs">
    <div class="nav-tab active" onclick="showSection('overview')">ğŸ  Overview</div>
    <div class="nav-tab" onclick="showSection('auth')">ğŸ” Auth & Eligibility</div>
    <div class="nav-tab" onclick="showSection('onboarding')">ğŸš€ Onboarding</div>
    <div class="nav-tab" onclick="showSection('hub')">ğŸ“± SMKT Hub</div>
    <div class="nav-tab" onclick="showSection('points')">ğŸŸ  Points</div>
    <div class="nav-tab" onclick="showSection('cashback')">ğŸŸ£ Cashback</div>
    <div class="nav-tab" onclick="showSection('trees')">ğŸŒ³ Trees</div>
    <div class="nav-tab" onclick="showSection('vouchers')">ğŸ« Vouchers</div>
    <div class="nav-tab" onclick="showSection('api')">âš¡ API Reference</div>
    <div class="nav-tab" onclick="showSection('architecture')">ğŸ—ï¸ Architecture</div>
</div>

<div class="section active" id="sec-overview">
    <div class="section-title">ğŸ—ºï¸ End-to-End Flow Overview</div>
    <div class="section-subtitle">The complete journey from user login to rewards interaction</div>
    <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:var(--raiffeisen-accent)"></div> System Step</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--raiffeisen-yellow)"></div> Decision</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--success-green)"></div> Success</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--error-red)"></div> Error / Block</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--points-orange)"></div> Points</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--cashback-purple)"></div> Cashback</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--trees-green)"></div> Trees</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--voucher-pink)"></div> Vouchers</div>
    </div>
    <div class="flow-container">
        <div class="flow-step"><div class="step-header"><div class="step-number">1</div><div class="step-title">User Login to OneApp (Smart Mobile)</div></div><div class="step-body">User authenticates via <code>ISAM</code> (transition) or <code>Cloud SSO</code> (target). Two parallel processes begin: async CRM product check + sync eligibility check.</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">Parallel processes</div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-yellow"><div class="step-header"><div class="step-number yellow">2</div><div class="step-title">Eligibility Check (Background)</div></div><div class="step-body"><code>GET /services/spending-categorization/v1/eligibility</code><br><br>System checks if user has both <strong>SM</strong> (Smart Mobile) and <strong>SMKT</strong> (Smart Market) products in <code>RO_USERS.PRODUCTS</code> table.<br><strong>Note:</strong> The ğŸ giftbox icon is always visible â€” eligibility is checked when the user taps it.</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-green"><div class="step-header"><div class="step-number green">3</div><div class="step-title">ğŸ Giftbox Icon Always Displayed</div></div><div class="step-body">The giftbox icon is <strong>always shown</strong> on the Dashboard header for all users, regardless of eligibility status. The eligibility check determines what happens <em>after</em> the user taps it.</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">User taps giftbox ğŸ</div><div class="arrow-head"></div></div>
        <div class="flow-step"><div class="step-header"><div class="step-number">4</div><div class="step-title">Client Status Check</div></div><div class="step-body"><code>GET /v1/client-status-check</code><br><br>Verifies SMKT enrollment, retrieves accountId from Redis cache or XLS backend. Returns <code>{ hasSmkt: true/false }</code></div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="decision-box">hasSmkt?</div>
        <div class="arrow-connector"><div class="arrow-line" style="height:12px"></div></div>
        <div class="branch-container">
            <div class="branch">
                <div class="branch-label yes">âœ… hasSmkt: true</div>
                <div class="flow-step highlight-green" style="max-width:100%"><div class="step-header"><div class="step-number green">â†’</div><div class="step-title">ğŸ“± Smart Market Hub</div></div><div class="step-body">User has SMKT product.<br>Proceed to rewards dashboard.</div></div>
            </div>
            <div class="branch">
                <div class="branch-label no">âŒ hasSmkt: false</div>
                <div class="flow-step highlight-yellow" style="max-width:100%"><div class="step-header"><div class="step-number yellow">â†’</div><div class="step-title">ğŸš€ Opt-in Flow</div></div><div class="step-body">User does NOT have SMKT product.<br>Redirect to opt-in / enrollment flow.</div></div>
            </div>
        </div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">hasSmkt: true path</div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-yellow"><div class="step-header"><div class="step-number yellow">5</div><div class="step-title">ğŸ“± Smart Market Hub</div></div><div class="step-body"><code>GET /v1/account-balance</code><br><br>Loads rewards dashboard with counters for <strong>Points</strong> (Pool 3), <strong>Cashback</strong> (Pool 2), <strong>Vouchers</strong> (eCoupons), <strong>Trees</strong> (Pool 4).</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">User selects reward type</div><div class="arrow-head"></div></div>
        <div class="branch-container" style="max-width:900px;gap:12px">
            <div class="flow-step highlight-orange" style="flex:1;max-width:100%"><div class="step-header"><div class="step-number orange">ğŸŸ </div><div class="step-title">Points</div></div><div class="step-body"><code>Pool.3</code><br>Balance, transactions, expiry, about carousel</div></div>
            <div class="flow-step highlight-purple" style="flex:1;max-width:100%"><div class="step-header"><div class="step-number purple">ğŸŸ£</div><div class="step-title">Cashback</div></div><div class="step-body"><code>Pool.2</code><br>Balance in LEI, auto-transferred monthly</div></div>
            <div class="flow-step" style="flex:1;max-width:100%;border-left-color:var(--trees-green)"><div class="step-header"><div class="step-number green">ğŸŒ³</div><div class="step-title">Trees</div></div><div class="step-body"><code>Pool.4</code><br>COâ‚‚ impact, conversion from points</div></div>
            <div class="flow-step highlight-pink" style="flex:1;max-width:100%"><div class="step-header"><div class="step-number pink">ğŸ«</div><div class="step-title">Vouchers</div></div><div class="step-body"><code>eCoupons</code><br>QR/barcode, redemption, expiry</div></div>
        </div>
    </div>
</div>

<div class="section" id="sec-auth">
    <div class="section-title">ğŸ” Authentication & Eligibility Flow</div>
    <div class="section-subtitle">How the system determines if a user can access Smart Market</div>
    <div class="flow-container">
        <div class="flow-step"><div class="step-header"><div class="step-number">1</div><div class="step-title">CRM Product Events (Async)</div></div><div class="step-body">CRM publishes events on <code>CRM.PRODUCT.TOPIC</code> when products are enrolled/unenrolled.<br><br><strong>Product Codes:</strong><br>ğŸª <code>RBRO_SMKT_PF</code> (P-93EZ9B) â†’ Smart Market<br>ğŸ“± <code>RBRO_SM_PF</code> (P-8C0OXI) â†’ Smart Mobile<br>ğŸ–¥ï¸ <code>RBRO_RO_PF</code> (P-8C0OV9) â†’ Raiffeisen Online<br><br><strong>Actions:</strong> <code>Add</code> â†’ save to DB | <code>Suspend</code> â†’ delete from DB</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">MQ Topic â†’ users-service</div><div class="arrow-head"></div></div>
        <div class="flow-step"><div class="step-header"><div class="step-number">2</div><div class="step-title">users-service updates RO_USERS.PRODUCTS</div></div><div class="step-body">Populates <code>PRODUCTS</code> table with <code>SM</code>, <code>SMKT</code>, <code>RO</code> per <code>USER_CIF</code>.<br>Only PF (individual) clients are stored.</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">At user login (sync)</div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-yellow"><div class="step-header"><div class="step-number yellow">3</div><div class="step-title">FE calls Eligibility API</div></div><div class="step-body"><code>GET /services/spending-categorization/v1/eligibility</code><br>Header: <code>iv-user: {CIF}</code><br><br>Calls â†’ <code>spending-categorization-service</code> â†’ <code>users-service</code> â†’ <code>RO_USERS DB</code><br><br>âœ… SM + SMKT both found â†’ <code>{ "isEligible": true }</code><br>âŒ Missing either â†’ <code>{ "isEligible": false }</code><br>âš ï¸ Response cached at user session level<br><br><strong>Note:</strong> The ğŸ giftbox icon is always displayed regardless of this result. The eligibility response determines the behavior <em>after</em> the user taps the icon.</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-green"><div class="step-header"><div class="step-number green">4</div><div class="step-title">Dashboard Display</div></div><div class="step-body">The ğŸ giftbox icon is <strong>always displayed</strong> on the Dashboard header for all users.<br><br>When tapped â†’ <code>GET /v1/client-status-check</code>:<br><code>hasSmkt: true</code> â†’ Proceed to <strong>Smart Market Hub</strong><br><code>hasSmkt: false</code> â†’ Redirect to <strong>Opt-in Flow</strong> (enrollment)<br><code>500 Error</code> â†’ No impact, treat gracefully</div></div>
    </div>
</div>

<div class="section" id="sec-onboarding">
    <div class="section-title">ğŸš€ Onboarding â€” Client Status Check</div>
    <div class="section-subtitle">Verifying SMKT enrollment: hasSmkt â†’ Hub, no SMKT â†’ Opt-in Flow</div>
    <div class="flow-container">
        <div class="flow-step"><div class="step-header"><div class="step-number">1</div><div class="step-title">User taps giftbox ğŸ on Dashboard</div></div><div class="step-body">BFF receives <code>GET /v1/client-status-check</code></div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-yellow"><div class="step-header"><div class="step-number yellow">2</div><div class="step-title">Check Redis Cache</div></div><div class="step-body">Key: <code>CIF</code> â†’ look for <code>accountId</code> with TTL<br><br>âœ… Found â†’ return <code>{ hasSmkt: true }</code> â†’ <strong>Smart Market Hub</strong><br>âŒ Not found â†’ proceed to Step 3</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">Cache miss</div><div class="arrow-head"></div></div>
        <div class="flow-step"><div class="step-header"><div class="step-number">3</div><div class="step-title">Query users-service</div></div><div class="step-body"><code>GET /v2/users/{CIF}</code><br><br>Returns list of products + optional <code>SMKT_AccountId</code></div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="decision-box">SMKT in products[] AND AccountId exists?</div>
        <div class="arrow-connector"><div class="arrow-line" style="height:12px"></div></div>
        <div class="branch-container">
            <div class="branch"><div class="branch-label yes">âœ… YES â€” Has AccountId</div><div class="flow-step highlight-green" style="max-width:100%"><div class="step-header"><div class="step-number green">âœ“</div><div class="step-title">Store & Return</div></div><div class="step-body">Store accountId in Redis<br>Return <code>{ hasSmkt: true }</code> â†’ <strong>Smart Market Hub</strong></div></div></div>
            <div class="branch"><div class="branch-label no">âš ï¸ NO â€” Missing AccountId</div><div class="flow-step highlight-yellow" style="max-width:100%"><div class="step-header"><div class="step-number yellow">â†’</div><div class="step-title">Call XLS Backend</div></div><div class="step-body"><code>GET /account/{CIF}?isUMI=true</code><br><br>Check XLS for accountId + Customer Status (attribute <code>2300000000</code>):<br>â€¢ Value <code>"0"</code> = Enabled â†’ store & return true â†’ <strong>Hub</strong><br>â€¢ Value <code>"1"</code> = Disabled â†’ unenroll â†’ return false â†’ <strong>Opt-in Flow</strong><br>â€¢ Not found â†’ unenroll â†’ return false â†’ <strong>Opt-in Flow</strong></div></div></div>
        </div>
    </div>
</div>

<div class="section" id="sec-hub">
    <div class="section-title">ğŸ“± Smart Market Hub</div>
    <div class="section-subtitle">The main rewards dashboard â€” the giftbox icon ğŸ is always visible on the Athena Dashboard</div>
    <div style="display:flex;gap:40px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
        <div class="phone-mockup"><div class="phone-screen"><div class="phone-statusbar"><span>9:41</span><span>ğŸ“¶ ğŸ”‹</span></div><div class="phone-header"><span style="font-size:1.2rem;cursor:pointer">â†</span><h3>Smart Market</h3><span style="font-size:1.2rem;cursor:pointer">âœ•</span></div>
        <div class="screen-state-tabs"><div class="screen-state-tab active" onclick="showPhoneState('hub', 'success', this)">âœ… Success</div><div class="screen-state-tab" onclick="showPhoneState('hub', 'loading', this)">â³ Loading</div><div class="screen-state-tab" onclick="showPhoneState('hub', 'error', this)">âŒ Error</div></div>
        <div class="phone-content screen-state-content active" id="hub-success"><div style="font-weight:700;font-size:0.82rem;margin-bottom:14px;color:#888;text-transform:uppercase;letter-spacing:0.5px">Recompensele mele</div><div class="hub-reward-row" onclick="showSection('points')" style="margin:0 -16px;padding-left:16px;padding-right:16px"><div class="hub-reward-icon" style="background:#fff3e0">â­</div><div class="hub-reward-info"><div class="rw-label">Puncte</div><div class="rw-value">150 puncte disponibile</div></div><div class="hub-reward-chevron">â€º</div></div><div class="hub-reward-row" onclick="showSection('cashback')" style="margin:0 -16px;padding-left:16px;padding-right:16px"><div class="hub-reward-icon" style="background:#f3e5f5">ğŸ’°</div><div class="hub-reward-info"><div class="rw-label">Cashback</div><div class="rw-value">25,50 Lei</div></div><div class="hub-reward-chevron">â€º</div></div><div class="hub-reward-row" onclick="showSection('vouchers')" style="margin:0 -16px;padding-left:16px;padding-right:16px"><div class="hub-reward-icon" style="background:#fce4ec">ğŸ«</div><div class="hub-reward-info"><div class="rw-label">Vouchere</div><div class="rw-value">3 vouchere active</div></div><div class="hub-reward-chevron">â€º</div></div><div class="hub-reward-row" onclick="showSection('trees')" style="margin:0 -16px;padding-left:16px;padding-right:16px"><div class="hub-reward-icon" style="background:#e8f5e9">ğŸŒ³</div><div class="hub-reward-info"><div class="rw-label">Copaci</div><div class="rw-value">7 copaci plantaÈ›i</div></div><div class="hub-reward-chevron">â€º</div></div><div style="margin-top:14px;display:flex;flex-direction:column;gap:8px"><div style="background:#f5f5f5;border-radius:12px;padding:13px 16px;cursor:pointer;font-size:0.82rem;font-weight:600;display:flex;align-items:center;gap:10px"><span>ğŸ”</span> ExploreazÄƒ campanii</div><div style="background:#f5f5f5;border-radius:12px;padding:13px 16px;cursor:pointer;font-size:0.82rem;font-weight:600;display:flex;align-items:center;gap:10px"><span>ğŸ“‹</span> Campaniile mele</div><div style="background:var(--raiffeisen-yellow);border-radius:12px;padding:13px 16px;cursor:pointer;font-size:0.82rem;font-weight:700;display:flex;align-items:center;gap:10px"><span>ğŸ’</span> FoloseÈ™te puncte</div></div></div>
        <div class="phone-content screen-state-content" id="hub-loading"><div style="font-weight:700;font-size:0.82rem;margin-bottom:14px;color:#888;text-transform:uppercase;letter-spacing:0.5px">Recompensele mele</div><div style="display:flex;flex-direction:column;gap:12px;align-items:center;padding:40px 0"><div style="width:48px;height:48px;border:3px solid #eee;border-top:3px solid var(--raiffeisen-yellow);border-radius:50%;animation:spin 0.8s linear infinite"></div><div style="font-size:0.8rem;color:#aaa">Se Ã®ncarcÄƒ recompensele...</div></div><style>@keyframes spin { to { transform: rotate(360deg); } }</style><div style="margin-top:20px"><div style="background:#f0f0f0;height:56px;border-radius:12px;margin-bottom:8px"></div><div style="background:#f0f0f0;height:56px;border-radius:12px;margin-bottom:8px"></div><div style="background:#f0f0f0;height:56px;border-radius:12px;margin-bottom:8px"></div><div style="background:#f0f0f0;height:56px;border-radius:12px"></div></div></div>
        <div class="phone-content screen-state-content" id="hub-error"><div style="font-weight:700;font-size:0.82rem;margin-bottom:14px;color:#888;text-transform:uppercase;letter-spacing:0.5px">Recompensele mele</div><div style="text-align:center;padding:40px 10px"><div style="font-size:3rem;margin-bottom:12px">ğŸ˜”</div><div style="font-size:0.88rem;font-weight:600;color:#333;margin-bottom:8px">Momentan, nu putem afiÈ™a recompensele</div><div style="font-size:0.78rem;color:#888;margin-bottom:20px">Te rugÄƒm sÄƒ Ã®ncerci mai tÃ¢rziu.</div><div style="display:inline-block;background:var(--raiffeisen-yellow);padding:10px 28px;border-radius:20px;font-size:0.8rem;font-weight:700;cursor:pointer">ÃncearcÄƒ din nou</div></div></div>
        <div class="figma-source"><svg viewBox="0 0 38 57" fill="#a259ff"><path d="M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/><path d="M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 0 1-19 0z"/><path d="M19 0v19h9.5a9.5 9.5 0 0 0 0-19H19z"/><path d="M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z"/><path d="M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z"/></svg> Figma: OneApp 2025 â€¢ node 749-80190</div></div></div>
        <div style="flex:1;min-width:300px"><div class="flow-step" style="margin-bottom:16px"><div class="step-header"><div class="step-number yellow">API</div><div class="step-title">GET /v1/account-balance</div></div><div class="step-body">Called when the Hub opens. Returns all reward balances in a single response.</div></div>
        <div class="pool-grid"><div class="pool-card p3"><div class="pool-id">Pool 3</div><div style="font-weight:700">â­ Points</div><div style="font-size:0.78rem;color:var(--text-secondary);margin-top:6px"><code>poolBalances[x].balanceDetails.quantity</code><br>where <code>poolId = 3</code></div></div><div class="pool-card p2"><div class="pool-id">Pool 2</div><div style="font-weight:700">ğŸ’° Cashback</div><div style="font-size:0.78rem;color:var(--text-secondary);margin-top:6px"><code>poolBalances[x].balanceDetails.amount</code><br>where <code>poolId = 2</code></div></div><div class="pool-card p4"><div class="pool-id">Pool 4</div><div style="font-weight:700">ğŸŒ³ Trees</div><div style="font-size:0.78rem;color:var(--text-secondary);margin-top:6px"><code>poolBalances[x].balanceDetails.quantity</code><br>where <code>poolId = 4</code></div></div><div class="pool-card pv"><div class="pool-id">eCoupons</div><div style="font-weight:700">ğŸ« Vouchers</div><div style="font-size:0.78rem;color:var(--text-secondary);margin-top:6px"><code>SUM(ecouponBalances[x].balanceDetails.quantity)</code></div></div></div></div>
    </div>
</div>

<div class="section" id="sec-points">
    <div class="section-title">ğŸŸ  Rewards â€” Points Flow</div>
    <div class="section-subtitle">Pool ID 3 â€¢ awardType = Pool.3 â€¢ Unit: Points</div>
    <div style="display:flex;gap:40px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
        <div class="phone-mockup"><div class="phone-screen"><div class="phone-statusbar"><span>9:41</span><span>ğŸ“¶ ğŸ”‹</span></div><div class="phone-header"><span>â†</span><h3>Puncte</h3><span>âœ•</span></div>
        <div class="screen-state-tabs"><div class="screen-state-tab active" onclick="showPhoneState('points', 'success', this)">âœ… Success</div><div class="screen-state-tab" onclick="showPhoneState('points', 'loading', this)">â³ Loading</div><div class="screen-state-tab" onclick="showPhoneState('points', 'zero', this)">0ï¸âƒ£ Zero</div><div class="screen-state-tab" onclick="showPhoneState('points', 'error', this)">âŒ Error</div></div>
        <div class="phone-content screen-state-content active" id="points-success" style="padding:0"><div class="balance-hero"><div class="hero-icon">â­</div><div class="hero-value" style="color:var(--points-orange)">150</div><div class="hero-unit">Puncte</div></div><div class="action-chips"><div class="action-chip" style="background:#fff3e0;color:#e65100">FoloseÈ™te-le</div><div class="action-chip" style="background:#fff3e0;color:#e65100">ObÈ›ine mai multe</div><div class="action-chip" style="background:#fff3e0;color:#e65100">Despre</div></div><div class="expiring-banner" style="background:#fff8e1"><div class="exp-icon">â³</div><div class="exp-text"><strong>100 puncte</strong> expirÄƒ Ã®n curÃ¢nd <span>29 Feb 2025</span></div><div class="exp-arrow">â€º</div></div><div class="ptx-header"><span>TranzacÈ›ii</span><span class="view-all" style="color:var(--points-orange)">Vezi toate</span></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">â†“</div><div class="ptx-detail"><div class="ptx-name">Campanie activatÄƒ</div><div class="ptx-date">15 Ian 2025</div></div><div class="ptx-amt credit">+50</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#ffebee">â†‘</div><div class="ptx-detail"><div class="ptx-name">AchiziÈ›ie voucher</div><div class="ptx-date">10 Ian 2025</div></div><div class="ptx-amt debit">âˆ’25</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">â†“</div><div class="ptx-detail"><div class="ptx-name">PlatÄƒ cu cardul</div><div class="ptx-date">08 Ian 2025</div></div><div class="ptx-amt credit">+10</div></div></div>
        <div class="phone-content screen-state-content" id="points-loading" style="padding-top:0"><div class="balance-hero"><div class="hero-icon">â­</div><div style="width:80px;height:28px;background:#f0f0f0;border-radius:8px;margin:8px auto"></div><div class="hero-unit">Puncte</div></div><div style="padding:0 16px"><div style="background:#f0f0f0;height:36px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:50px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:44px;border-radius:10px;margin-bottom:8px"></div><div style="background:#f0f0f0;height:44px;border-radius:10px;margin-bottom:8px"></div></div></div>
        <div class="phone-content screen-state-content" id="points-zero" style="padding:0"><div class="balance-hero"><div class="hero-icon">â­</div><div class="hero-value" style="color:#ccc">0</div><div class="hero-unit">Puncte</div></div><div class="action-chips"><div class="action-chip" style="background:#fff3e0;color:#e65100">ObÈ›ine puncte</div><div class="action-chip" style="background:#fff3e0;color:#e65100">Despre</div></div><div style="text-align:center;padding:30px 20px;color:#aaa;font-size:0.8rem"><div style="font-size:2rem;margin-bottom:8px">ğŸ“­</div>Nu ai tranzacÈ›ii Ã®ncÄƒ</div></div>
        <div class="phone-content screen-state-content" id="points-error"><div style="text-align:center;padding:50px 16px"><div style="font-size:3rem;margin-bottom:12px">ğŸ˜”</div><div style="font-size:0.85rem;font-weight:600;color:#333;margin-bottom:6px">Nu am putut Ã®ncÄƒrca punctele</div><div style="font-size:0.78rem;color:#888;margin-bottom:20px">Te rugÄƒm sÄƒ Ã®ncerci din nou.</div><div style="display:inline-block;background:var(--raiffeisen-yellow);padding:10px 28px;border-radius:20px;font-size:0.8rem;font-weight:700;cursor:pointer">ReÃ®ncearcÄƒ</div></div></div>
        <div class="figma-source"><svg viewBox="0 0 38 57" fill="#a259ff" style="width:10px;height:10px"><path d="M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/><path d="M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 0 1-19 0z"/><path d="M19 0v19h9.5a9.5 9.5 0 0 0 0-19H19z"/><path d="M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z"/><path d="M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z"/></svg> Figma: OneApp 2025 â€¢ node 2-34970</div></div></div>
        <div style="flex:1;min-width:300px"><div class="flow-container"><div class="flow-step highlight-orange"><div class="step-header"><div class="step-number orange">1</div><div class="step-title">User taps "Points" from Hub</div></div><div class="step-body">Display loading screen. Balance already available from <code>account-balance</code> call.</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step highlight-orange"><div class="step-header"><div class="step-number orange">2</div><div class="step-title">Fetch Transactions</div></div><div class="step-body"><code>GET /v1/transactions?awardType=Pool.3&limit=3&page=1</code><br><br>Shows 3 most recent point transactions.</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step highlight-orange"><div class="step-header"><div class="step-number orange">3</div><div class="step-title">Display Points Screen</div></div><div class="step-body"><strong>Balance:</strong> <code>poolBalances[poolId=3].balanceDetails.quantity</code><br><strong>Expiring:</strong> <code>poolBucketsDetails</code> items with <code>expiryDate</code><br><strong>Transactions:</strong> Credit (â†“ +) / Debit (â†‘ -)</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-label">User actions</div><div class="arrow-head"></div></div><div class="branch-container" style="gap:10px"><div class="flow-step" style="flex:1;max-width:100%;border-left-color:var(--points-orange)"><div class="step-title" style="font-size:0.85rem">ğŸ“‹ View All TX</div><div class="step-body" style="font-size:0.78rem"><code>limit=10</code>, paginated, grouped by month</div></div><div class="flow-step" style="flex:1;max-width:100%;border-left-color:var(--points-orange)"><div class="step-title" style="font-size:0.85rem">ğŸ“„ TX Detail</div><div class="step-body" style="font-size:0.78rem">Bottom sheet: label, date, campaign, quantity</div></div><div class="flow-step" style="flex:1;max-width:100%;border-left-color:var(--points-orange)"><div class="step-title" style="font-size:0.85rem">â„¹ï¸ About</div><div class="step-body" style="font-size:0.78rem">4-step carousel (stories)</div></div></div></div>
        <div style="margin-top:20px"><strong>Jira Stories:</strong><br><span class="jira-badge">ARO-49507</span><span class="jira-badge">ARO-49861</span><span class="jira-badge">ARO-49865</span><span class="jira-badge">ARO-49866</span><span class="jira-badge">ARO-49963</span><span class="jira-badge">ARO-53319</span></div></div>
    </div>
</div>

<div class="section" id="sec-cashback">
    <div class="section-title">ğŸŸ£ Rewards â€” Cashback Flow</div>
    <div class="section-subtitle">Pool ID 2 â€¢ awardType = Pool.2 â€¢ Unit: Lei (RON)</div>
    <div style="display:flex;gap:40px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
        <div class="phone-mockup"><div class="phone-screen"><div class="phone-statusbar"><span>9:41</span><span>ğŸ“¶ ğŸ”‹</span></div><div class="phone-header"><span>â†</span><h3>Cashback</h3><span>âœ•</span></div>
        <div class="screen-state-tabs"><div class="screen-state-tab active" onclick="showPhoneState('cashback', 'success', this)">âœ… Success</div><div class="screen-state-tab" onclick="showPhoneState('cashback', 'loading', this)">â³ Loading</div><div class="screen-state-tab" onclick="showPhoneState('cashback', 'empty', this)">ğŸ“­ Empty</div><div class="screen-state-tab" onclick="showPhoneState('cashback', 'error', this)">âŒ Error</div></div>
        <div class="phone-content screen-state-content active" id="cashback-success" style="padding:0"><div class="balance-hero"><div class="hero-icon">ğŸ’°</div><div class="hero-value" style="color:var(--cashback-purple)">25,50 <span style="font-size:1rem;font-weight:400">Lei</span></div><div class="hero-unit">Cashback</div></div><div class="action-chips"><div class="action-chip" style="background:#f3e5f5;color:#6a1b9a">ObÈ›ine cashback</div><div class="action-chip" style="background:#f3e5f5;color:#6a1b9a">Despre cashback</div></div><div class="info-banner" style="background:#f3e5f5;color:#6a1b9a"><span>â„¹ï¸</span><span>Ãn fiecare lunÄƒ, transferÄƒm automat cashback-ul Ã®n contul tÄƒu curent.</span></div><div class="ptx-header"><span>TranzacÈ›ii</span><span class="view-all" style="color:var(--cashback-purple)">Vezi toate</span></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">â†“</div><div class="ptx-detail"><div class="ptx-name">Bonus platÄƒ cu cardul</div><div class="ptx-date">12 Ian 2025</div></div><div class="ptx-amt credit">+2,50 Lei</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">â†“</div><div class="ptx-detail"><div class="ptx-name">CumpÄƒrÄƒturÄƒ online</div><div class="ptx-date">08 Ian 2025</div></div><div class="ptx-amt credit">+1,20 Lei</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">â†“</div><div class="ptx-detail"><div class="ptx-name">Shopping campanie</div><div class="ptx-date">03 Ian 2025</div></div><div class="ptx-amt credit">+5,80 Lei</div></div></div>
        <div class="phone-content screen-state-content" id="cashback-loading" style="padding-top:0"><div class="balance-hero"><div class="hero-icon">ğŸ’°</div><div style="width:100px;height:28px;background:#f0f0f0;border-radius:8px;margin:8px auto"></div><div class="hero-unit">Cashback</div></div><div style="padding:0 16px"><div style="background:#f0f0f0;height:36px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:50px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:44px;border-radius:10px;margin-bottom:8px"></div></div></div>
        <div class="phone-content screen-state-content" id="cashback-empty" style="padding:0"><div class="balance-hero"><div class="hero-icon">ğŸ’°</div><div class="hero-value" style="color:#ccc">0,00 <span style="font-size:1rem;font-weight:400">Lei</span></div><div class="hero-unit">Cashback</div></div><div class="action-chips"><div class="action-chip" style="background:#f3e5f5;color:#6a1b9a">ObÈ›ine cashback</div><div class="action-chip" style="background:#f3e5f5;color:#6a1b9a">Despre</div></div><div class="info-banner" style="background:#f3e5f5;color:#6a1b9a"><span>â„¹ï¸</span><span>Ãn fiecare lunÄƒ, transferÄƒm automat cashback-ul Ã®n contul tÄƒu curent.</span></div><div style="text-align:center;padding:20px;color:#aaa;font-size:0.8rem"><div style="font-size:2rem;margin-bottom:8px">ğŸ“­</div>Nu ai tranzacÈ›ii Ã®ncÄƒ</div></div>
        <div class="phone-content screen-state-content" id="cashback-error"><div style="text-align:center;padding:50px 16px"><div style="font-size:3rem;margin-bottom:12px">ğŸ˜”</div><div style="font-size:0.85rem;font-weight:600;color:#333;margin-bottom:6px">Nu am putut Ã®ncÄƒrca cashback-ul</div><div style="font-size:0.78rem;color:#888;margin-bottom:20px">Te rugÄƒm sÄƒ Ã®ncerci din nou.</div><div style="display:inline-block;background:var(--raiffeisen-yellow);padding:10px 28px;border-radius:20px;font-size:0.8rem;font-weight:700;cursor:pointer">ReÃ®ncearcÄƒ</div></div></div>
        <div class="figma-source"><svg viewBox="0 0 38 57" fill="#a259ff" style="width:10px;height:10px"><path d="M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/><path d="M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 0 1-19 0z"/><path d="M19 0v19h9.5a9.5 9.5 0 0 0 0-19H19z"/><path d="M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z"/><path d="M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z"/></svg> Figma: OneApp 2025 â€¢ node 749-97139</div></div></div>
        <div style="flex:1;min-width:300px"><div class="flow-container"><div class="flow-step highlight-purple"><div class="step-header"><div class="step-number purple">1</div><div class="step-title">Fetch Cashback Transactions</div></div><div class="step-body"><code>GET /v1/transactions?awardType=Pool.2&limit=3&page=1</code><br><br>Balance from: <code>poolBalances[poolId=2].balanceDetails.amount</code></div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step highlight-purple"><div class="step-header"><div class="step-number purple">2</div><div class="step-title">Key Difference: Amount-based</div></div><div class="step-body">Unlike Points (quantity), Cashback uses <code>.amount</code> field with <strong>Lei</strong> currency label.<br>Cashback is <strong>auto-transferred monthly</strong> to the user's main Raiffeisen current account.</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step highlight-purple"><div class="step-header"><div class="step-number purple">3</div><div class="step-title">About Cashback Carousel</div></div><div class="step-body">3 stories:<br>1ï¸âƒ£ Activate a campaign that offers cashback<br>2ï¸âƒ£ Check your cashback balance (updated after merchant return period)<br>3ï¸âƒ£ Cashback transferred monthly to main account</div></div></div>
        <div style="margin-top:20px"><strong>Jira Stories:</strong><br><span class="jira-badge">ARO-49805</span><span class="jira-badge">ARO-49940</span><span class="jira-badge">ARO-50017</span><span class="jira-badge">ARO-50018</span></div></div>
    </div>
</div>

<div class="section" id="sec-trees">
    <div class="section-title">ğŸŒ³ Rewards â€” Trees Flow</div>
    <div class="section-subtitle">Pool ID 4 â€¢ Endpoint: /v1/trees â€¢ Points â†’ Trees conversion</div>
    <div style="display:flex;gap:40px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
        <div class="phone-mockup"><div class="phone-screen"><div class="phone-statusbar"><span>9:41</span><span>ğŸ“¶ ğŸ”‹</span></div><div class="phone-header"><span>â†</span><h3>Copaci</h3><span>âœ•</span></div>
        <div class="screen-state-tabs"><div class="screen-state-tab active" onclick="showPhoneState('trees', 'success', this)">âœ… Success</div><div class="screen-state-tab" onclick="showPhoneState('trees', 'loading', this)">â³ Loading</div><div class="screen-state-tab" onclick="showPhoneState('trees', 'empty', this)">ğŸ“­ Empty</div><div class="screen-state-tab" onclick="showPhoneState('trees', 'error', this)">âŒ Error</div></div>
        <div class="phone-content screen-state-content active" id="trees-success" style="padding:0"><div class="balance-hero"><div class="hero-icon">ğŸŒ³</div><div class="hero-value" style="color:var(--trees-green)">7</div><div class="hero-unit">Copaci plantaÈ›i</div></div><div class="action-chips"><div class="action-chip" style="background:#e8f5e9;color:#2e7d32">PlanteazÄƒ</div><div class="action-chip" style="background:#e8f5e9;color:#2e7d32">ObÈ›ine puncte</div><div class="action-chip" style="background:#e8f5e9;color:#2e7d32">Despre</div></div><div class="co2-banner" style="background:#e8f5e9"><div style="font-size:1.2rem">ğŸŒ±</div><div class="co2-value" style="color:var(--trees-green)">825 kg COâ‚‚e</div><div class="co2-label">Impact estimat pe 5 ani</div></div><div class="ptx-header"><span>TranzacÈ›ii</span><span class="view-all" style="color:var(--trees-green)">Vezi toate</span></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">ğŸŒ³</div><div class="ptx-detail"><div class="ptx-name">ContribuÈ›ie copaci</div><div class="ptx-date">05 Ian 2025</div></div><div class="ptx-amt credit">+2 ğŸŒ³</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">ğŸŒ³</div><div class="ptx-detail"><div class="ptx-name">ContribuÈ›ie copaci</div><div class="ptx-date">20 Dec 2024</div></div><div class="ptx-amt credit">+1 ğŸŒ³</div></div><div class="ptx-item"><div class="ptx-dot" style="background:#e8f5e9">ğŸŒ³</div><div class="ptx-detail"><div class="ptx-name">Campanie plantare</div><div class="ptx-date">15 Dec 2024</div></div><div class="ptx-amt credit">+4 ğŸŒ³</div></div></div>
        <div class="phone-content screen-state-content" id="trees-loading" style="padding-top:0"><div class="balance-hero"><div class="hero-icon">ğŸŒ³</div><div style="width:60px;height:28px;background:#f0f0f0;border-radius:8px;margin:8px auto"></div><div class="hero-unit">Copaci</div></div><div style="padding:0 16px"><div style="background:#f0f0f0;height:36px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:60px;border-radius:10px;margin-bottom:10px"></div><div style="background:#f0f0f0;height:44px;border-radius:10px;margin-bottom:8px"></div><div style="background:#f0f0f0;height:44px;border-radius:10px"></div></div></div>
        <div class="phone-content screen-state-content" id="trees-empty" style="padding:0"><div class="balance-hero"><div class="hero-icon">ğŸŒ³</div><div class="hero-value" style="color:#ccc">0</div><div class="hero-unit">Copaci plantaÈ›i</div></div><div class="action-chips"><div class="action-chip" style="background:#e8f5e9;color:#2e7d32">PlanteazÄƒ acum</div><div class="action-chip" style="background:#e8f5e9;color:#2e7d32">Despre</div></div><div style="text-align:center;padding:30px 20px;color:#aaa;font-size:0.8rem"><div style="font-size:2rem;margin-bottom:8px">ğŸŒ±</div>PlanteazÄƒ primul tÄƒu copac<br>folosind punctele acumulate</div></div>
        <div class="phone-content screen-state-content" id="trees-error"><div style="text-align:center;padding:50px 16px"><div style="font-size:3rem;margin-bottom:12px">ğŸ˜”</div><div style="font-size:0.85rem;font-weight:600;color:#333;margin-bottom:6px">Nu am putut Ã®ncÄƒrca copacii</div><div style="font-size:0.78rem;color:#888;margin-bottom:20px">Te rugÄƒm sÄƒ Ã®ncerci din nou.</div><div style="display:inline-block;background:var(--raiffeisen-yellow);padding:10px 28px;border-radius:20px;font-size:0.8rem;font-weight:700;cursor:pointer">ReÃ®ncearcÄƒ</div></div></div>
        <div class="figma-source"><svg viewBox="0 0 38 57" fill="#a259ff" style="width:10px;height:10px"><path d="M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/><path d="M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 0 1-19 0z"/><path d="M19 0v19h9.5a9.5 9.5 0 0 0 0-19H19z"/><path d="M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z"/><path d="M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z"/></svg> Figma: OneApp 2025 â€¢ node 749-102699</div></div></div>
        <div style="flex:1;min-width:300px"><div class="flow-container"><div class="flow-step" style="border-left-color:var(--trees-green)"><div class="step-header"><div class="step-number green">1</div><div class="step-title">Trees Use Conversion Model</div></div><div class="step-body">Trees have a <strong>different endpoint</strong>: <code>GET /v1/trees</code> (not <code>/transactions</code>).<br><br>Trees are obtained by <strong>converting Points â†’ Trees</strong> via <code>POST /v1/reward-conversion</code>.</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step" style="border-left-color:var(--trees-green)"><div class="step-header"><div class="step-number green">2</div><div class="step-title">Conversion Data Model</div></div><div class="step-body"><code>convertFrom</code>: Pool 3 (Points) â€” debit quantity<br><code>convertTo</code>: Pool 4 (Trees) â€” credit quantity<br><code>poolWeight</code>: COâ‚‚ impact value<br><br>Example: 10 points â†’ 2 trees (poolWeight: 2 = COâ‚‚ factor)</div></div><div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div><div class="flow-step" style="border-left-color:var(--trees-green)"><div class="step-header"><div class="step-number green">3</div><div class="step-title">Transaction Detail (Bottom Sheet)</div></div><div class="step-body">Shows: Trees contributed, Campaign name, Points used (debit), Environmental impact (COâ‚‚e from poolWeight)</div></div></div>
        <div style="margin-top:20px"><strong>Jira Stories:</strong><br><span class="jira-badge">ARO-50091</span><span class="jira-badge">ARO-50254</span><span class="jira-badge">ARO-50256</span><span class="jira-badge">ARO-50291</span></div></div>
    </div>
</div>

<div class="section" id="sec-vouchers">
    <div class="section-title">ğŸ« Rewards â€” Vouchers Flow</div>
    <div class="section-subtitle">eCoupon-based rewards â€¢ QR/Barcode redemption</div>
    <div class="flow-container">
        <div class="flow-step highlight-pink"><div class="step-header"><div class="step-number pink">1</div><div class="step-title">Vouchers from account-balance</div></div><div class="step-body">Vouchers are <code>ecouponBalances[]</code> in the <code>account-balance</code> response.<br>Count: <code>SUM(ecouponBalances[x].balanceDetails.quantity)</code><br><br>Types: <strong>Monetary</strong> (% or fixed amount off) | <strong>Non-Monetary</strong> (product/service)</div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-pink"><div class="step-header"><div class="step-number pink">2</div><div class="step-title">Voucher Lifecycle</div></div><div class="step-body"><strong>Browse:</strong> View voucher details (image, name, value, expiry, merchant)<br><strong>Redeem:</strong> <code>POST /v1/voucher-adjustment</code><br><strong>QR Code:</strong> <code>GET /v1/qr-barcode</code> â€” for in-store redemption<br><strong>Expired:</strong> <code>GET /v1/vouchers-expired</code> â†’ <code>DELETE /v1/vouchers-expired</code></div></div>
        <div class="arrow-connector"><div class="arrow-line"></div><div class="arrow-head"></div></div>
        <div class="flow-step highlight-pink"><div class="step-header"><div class="step-number pink">3</div><div class="step-title">How to Get Vouchers</div></div><div class="step-body">Users can <strong>convert Points to Vouchers</strong> via <code>POST /v1/reward-conversion</code> in the "Use Points" section, or earn them through campaigns.</div></div>
    </div>
    <div style="margin-top:20px;text-align:center"><strong>Key Epic:</strong> <span class="jira-badge">ARO-50510</span> [ONEAPP] [SMKT] Rewards - Vouchers</div>
</div>

<div class="section" id="sec-api">
    <div class="section-title">âš¡ BFF API Reference</div>
    <div class="section-subtitle">smart-market-service â€¢ Base: /services/smart-market-bff/v1 â€¢ ISAM protected</div>
    <table class="api-table"><thead><tr><th>#</th><th>Method</th><th>Endpoint</th><th>Purpose</th><th>Backend</th></tr></thead><tbody>
    <tr><td>1</td><td><span class="method-badge get">GET</span></td><td><code>/v1/client-status-check</code></td><td>Check SMKT enrollment + accountId</td><td>users-service â†’ XLS</td></tr>
    <tr><td>2</td><td><span class="method-badge get">GET</span></td><td><code>/v1/account-balance</code></td><td>All rewards balance (Hub data)</td><td>XLS Account API</td></tr>
    <tr><td>3</td><td><span class="method-badge get">GET</span></td><td><code>/v1/transactions</code></td><td>Points/Cashback transaction history</td><td>XLS Transaction API</td></tr>
    <tr><td>4</td><td><span class="method-badge get">GET</span></td><td><code>/v1/trees</code></td><td>Tree contribution history</td><td>XLS Convert API</td></tr>
    <tr><td>5</td><td><span class="method-badge get">GET</span></td><td><code>/v1/images</code></td><td>Proxy campaign/voucher images</td><td>XLS CDN</td></tr>
    <tr><td>6</td><td><span class="method-badge get">GET</span></td><td><code>/v1/pdfs</code></td><td>Proxy PDF documents</td><td>XLS CDN</td></tr>
    <tr><td>7</td><td><span class="method-badge get">GET</span></td><td><code>/v1/vouchers-expired</code></td><td>List expired vouchers</td><td>XLS eCoupon API</td></tr>
    <tr><td>8</td><td><span class="method-badge get">GET</span></td><td><code>/v1/offers</code></td><td>Browse available offers</td><td>XLS Offer API</td></tr>
    <tr><td>9</td><td><span class="method-badge get">GET</span></td><td><code>/v1/clipped-campaigns</code></td><td>User-activated campaigns</td><td>XLS Campaign API</td></tr>
    <tr><td>10</td><td><span class="method-badge get">GET</span></td><td><code>/v1/psl-campaigns</code></td><td>Pre-selected campaigns</td><td>XLS Campaign API</td></tr>
    <tr><td>11</td><td><span class="method-badge get">GET</span></td><td><code>/v1/merchant-campaigns</code></td><td>Partner merchant campaigns</td><td>XLS Campaign API</td></tr>
    <tr><td>12</td><td><span class="method-badge delete">DEL</span></td><td><code>/v1/vouchers-expired</code></td><td>Remove expired vouchers</td><td>XLS eCoupon API</td></tr>
    <tr><td>13</td><td><span class="method-badge post">POST</span></td><td><code>/v1/voucher-adjustment</code></td><td>Adjust/redeem voucher</td><td>XLS eCoupon API</td></tr>
    <tr><td>14</td><td><span class="method-badge post">POST</span></td><td><code>/v1/offer-redemption</code></td><td>Redeem an offer</td><td>XLS Offer API</td></tr>
    <tr><td>15</td><td><span class="method-badge post">POST</span></td><td><code>/v1/reward-conversion</code></td><td>Convert points â†’ trees/vouchers</td><td>XLS Convert API</td></tr>
    <tr><td>16</td><td><span class="method-badge get">GET</span></td><td><code>/v1/qr-barcode</code></td><td>Generate QR/barcode for vouchers</td><td>XLS Barcode API</td></tr>
    <tr><td>17</td><td><span class="method-badge post">POST</span></td><td><code>/v1/smkt-accountid</code></td><td>Store SMKT account ID</td><td>users-service (internal)</td></tr>
    </tbody></table>
</div>

<div class="section" id="sec-architecture">
    <div class="section-title">ğŸ—ï¸ Architecture Migration Phases</div>
    <div class="section-subtitle">From standalone app with Auth0 â†’ fully integrated OneApp with Cloud SSO</div>
    <div class="arch-grid">
        <div class="arch-card current"><div class="phase-label">ğŸ”´ Phase 1 â€” Current</div><h4>Standalone Smart Market (Auth0)</h4><div class="arch-flow"><div class="arch-node">ğŸ“± SMKT App</div><div class="arch-arrow">â†’</div><div class="arch-node" style="background:#ffebee">ğŸ” Auth0 (AWS)</div><div class="arch-arrow">â†’</div><div class="arch-node">ğŸŒ WebView</div><div class="arch-arrow">â†’</div><div class="arch-node">XLS Backend</div></div><div style="font-size:0.82rem;color:var(--text-secondary);margin-top:8px">Smart Market runs as a <strong>separate app</strong> with its own Auth0 authentication. Accessed via WebView/hybrid approach from Smart Mobile.</div></div>
        <div class="arch-card transition"><div class="phase-label">ğŸŸ  Phase 2 â€” Transition (SMKT-2882)</div><h4>ISAM Integration</h4><div class="arch-flow"><div class="arch-node">ğŸ“± OneApp</div><div class="arch-arrow">â†’</div><div class="arch-node" style="background:#fff3e0">ğŸ” ISAM</div><div class="arch-arrow">â†’</div><div class="arch-node">smart-market-bff</div><div class="arch-arrow">â†’</div><div class="arch-node">XLS Backend</div></div><div style="font-size:0.82rem;color:var(--text-secondary);margin-top:8px">SMKT screens <strong>natively integrated</strong> into OneApp. New BFF proxies all XLS calls. Auth via ISAM. Auth0 available as fallback.</div></div>
        <div class="arch-card target"><div class="phase-label">ğŸŸ¢ Phase 3 â€” Target (SMKT-2880)</div><h4>Cloud SSO + Full OneApp</h4><div class="arch-flow"><div class="arch-node">ğŸ“± OneApp</div><div class="arch-arrow">â†’</div><div class="arch-node" style="background:#e8f5e9">ğŸ” Cloud SSO</div><div class="arch-arrow">â†’</div><div class="arch-node">smart-market-bff</div><div class="arch-arrow">â†’</div><div class="arch-node">XLS Backend</div></div><div style="font-size:0.82rem;color:var(--text-secondary);margin-top:8px">Single sign-on via <strong>Cloud SSO</strong>. Full native integration. Auth0 decommissioned. Old services (<code>smkt-merlin-product-consumer</code>, <code>rbro-piath-smart-market-bff</code>) deleted.</div></div>
    </div>
    <div style="margin-top:24px"><div class="section-title" style="font-size:1.2rem">ğŸ“¦ Service Details</div><table class="api-table" style="max-width:700px"><tr><td style="font-weight:600">Service Name</td><td><code>smart-market-service</code></td></tr><tr><td style="font-weight:600">Repository</td><td><code>smart-market-bff</code></td></tr><tr><td style="font-weight:600">Language</td><td>Java 21</td></tr><tr><td style="font-weight:600">Build Tool</td><td>Gradle 8.9</td></tr><tr><td style="font-weight:600">Project</td><td>Athena</td></tr><tr><td style="font-weight:600">Latest Version</td><td>v0.59.0 (Jan 15, 2026)</td></tr><tr><td style="font-weight:600">Deployment</td><td>CI/CD</td></tr><tr><td style="font-weight:600">EA Path</td><td>LOYL - Loyalty Smart Market OneAPP Target</td></tr></table></div>
</div>

<div style="text-align:center;padding:30px;color:var(--text-secondary);font-size:0.8rem">Generated from Confluence (SML, EA2, ARO, PSD2Team) & Jira (SMKT, ARO) â€” Feb 2026<br>Smart Market OneApp Integration â€” Raiffeisen Bank Romania</div>

<script>
function showSection(id) { document.querySelectorAll('.section').forEach(function(s){s.classList.remove('active')}); document.querySelectorAll('.nav-tab').forEach(function(t){t.classList.remove('active')}); document.getElementById('sec-' + id).classList.add('active'); var tabs = document.querySelectorAll('.nav-tab'); var tabMap = {'overview':0,'auth':1,'onboarding':2,'hub':3,'points':4,'cashback':5,'trees':6,'vouchers':7,'api':8,'architecture':9}; if (tabMap[id] !== undefined) tabs[tabMap[id]].classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }
function showPhoneState(screen, state, tabEl) { var allStates = document.querySelectorAll('[id^="' + screen + '-"]'); allStates.forEach(function(s){s.classList.remove('active')}); var target = document.getElementById(screen + '-' + state); if (target) target.classList.add('active'); var tabs = tabEl.parentElement.querySelectorAll('.screen-state-tab'); tabs.forEach(function(t){t.classList.remove('active')}); tabEl.classList.add('active'); }
</script>
</body>
</html>